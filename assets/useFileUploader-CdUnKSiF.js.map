{"version":3,"file":"useFileUploader-CdUnKSiF.js","sources":["../../../../apps/ds-playground/src/stories/components/useFileUploaderReturnValuesTable.md?raw","../../../../apps/ds-playground/src/stories/components/useFileUploaderParametersTable.md?raw","../../../../apps/ds-playground/src/stories/components/useFileUploader.mdx"],"sourcesContent":["export default \"| Returverdi                        | Type                       | Beskrivelse                                                      |\\n| --------------------------------- | -------------------------- | ---------------------------------------------------------------- |\\n| `fileUploaderState.uploadedFiles` | `Array<UploadedFile>`      | Liste over filer som er lastet opp                               |\\n| `fileUploaderState.uploadResult`  | `UploadResult ⏐ undefined` | Resultat av opplasting, inkludert statustekster og feilmeldinger |\\n| `fileUploaderState.isUploading`   | `boolean`                  | Om opplasting pågår                                              |\\n| `setSuccess`                      | `Function`                 | Funksjon for å indikere vellyket opplasting                      |\\n| `setLoading`                      | `Function`                 | Funksjon for å indikere at opplasting pågår                      |\\n| `setFailure`                      | `Function`                 | Funksjon for å indikere feil under opplasting                    |\\n| `remove`                          | `Function`                 | Funksjon for å fjerne en fil fra listen over opplastede filer    |\\n\"","export default \"| Parameter                | Type                                         | Beskrivelse                                                                   |\\n| ------------------------ | -------------------------------------------- | ----------------------------------------------------------------------------- |\\n| `renderStatus`           | `(status: UploadResultData<T>) => ReactNode` | Valgfri funksjon for å tilpasse visningen av statusmeldinger etter opplasting |\\n| `initiallyUploadedFiles` | `Array<UploadedFile>`                        | Valgfri liste av filer som er initialt opplastet                              |\\n\"","import ReturnValuesTable from './useFileUploaderReturnValuesTable.md?raw';\nimport ParametersTable from './useFileUploaderParametersTable.md?raw';\nimport { Meta, Markdown } from '@storybook/blocks';\n\n<Meta title=\"Komponenter/FileUploader/useFileUploader\" />\n\n# useFileUploader\n\n`useFileUploader` er en React hook som kan brukes for å administrere opplastingstilstand for filer i en FileUploader-komponent.\n\n## Importering\n\n```jsx\nimport { FileUploader } from '@skatteetaten/ds-forms';\n\n// Hooken hentes fra FileUploader-komponenten\nconst { useFileUploader } = FileUploader;\n```\n\n## API\n\n```typescript\nconst [\n  fileUploaderState,\n  setSuccess,\n  setLoading,\n  setFailure,\n  remove\n] = useFileUploader<T>(\n  renderStatus?: (status: UploadResultData<T>) => ReactNode,\n  initiallyUploadedFiles?: Array<UploadedFile>\n);\n```\n\n### Parametere\n\n<Markdown>{ParametersTable}</Markdown>\n\n### Returverdier\n\n```typescript\n[\n  // Tilstand\n  {\n    uploadedFiles: Array<UploadedFile>;\n    uploadResult: UploadResult | undefined;\n    isUploading: boolean;\n  },\n  // Metoder\n  setSuccess: (files: Array<UploadedFile>, data?: T) => void,\n  setLoading: () => void,\n  setFailure: (files: Array<UploadedFile>, errorMessage: T, succeededFiles?: Array<UploadedFile>) => void,\n  remove: (file: UploadedFile) => void\n]\n```\n\n<Markdown>{ReturnValuesTable}</Markdown>\n\n## Beskrivelse\n\n`useFileUploader` er en hook som håndterer tilstanden til filopplasting i et grensesnitt. Den håndterer opplastede filer, statusmeldinger, og tilbyr funksjoner for å administrere hele opplastingsprosessen.\n\nHooken støtter generiske typer (`<T>`) som kan brukes for å definere egne datatyper til statusmeldinger.\n\n### Validering og feilhåndtering\n\nHooken utfører automatisk validering for å sikre at duplikate filer ikke legges til:\n\n- Hvis en fil med samme `id` allerede finnes i tilstanden, vil `setSuccess` og `setFailure` kaste en feil.\n- For filer uten `id` brukes filnavnet til å sjekke for duplikater.\n\n## Eksempel\n\nNedenfor er et eksempel på hvordan `useFileUploader` kan brukes i en React-komponent:\n\n```jsx\nimport { FileUploader, UploadedFile } from '@skatteetaten/ds-forms';\n\nexport const FileUploaderTest = () => {\n  // Destrukturering av returverdier fra hooken\n  const [fileUploaderState, setSuccess, setLoading, setFailure, remove] =\n    FileUploader.useFileUploader();\n\n  const handleDelete = async (file: UploadedFile): Promise<boolean> => {\n    try {\n      // Simulerer et API-kall for å slette filen\n      const response = await fetch(`/api/files/${file.id}`, {\n        method: 'DELETE',\n      });\n\n      if (response.ok) {\n        // Fjerner filen fra tilstanden\n        remove(file);\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error('Feil under sletting av fil:', error);\n      return false;\n    }\n  };\n\n  const handleChange = async (files: File[]): Promise<void> => {\n    try {\n      // Indikerer at opplasting pågår\n      setLoading();\n\n      // Simulerer API-kall for opplasting\n      const results = await Promise.allSettled(\n        files.map(file => uploadFileToServer(file))\n      );\n\n      // Kategoriserer resultatet\n      const succeeded: UploadedFile[] = [];\n      const failed: UploadedFile[] = [];\n      const errorsByType: Record<string, { error: string, files: UploadedFile[] }> = {};\n\n      results.forEach((result, index) => {\n        if (result.status === 'fulfilled') {\n          succeeded.push({\n            name: files[index].name,\n            id: result.value.id,\n            href: result.value.url\n          });\n        } else {\n          // Finn eller opprett feilkategori\n          const errorType = result.reason.code || 'unknown';\n          const errorMessage = result.reason.message || 'Ukjent feil';\n\n          if (!errorsByType[errorType]) {\n            errorsByType[errorType] = {\n              error: errorMessage,\n              files: []\n            };\n          }\n\n          const failedFile = { name: files[index].name };\n          failed.push(failedFile);\n          errorsByType[errorType].files.push(failedFile);\n        }\n      });\n\n      // Håndter resultatet\n      if (failed.length > 0) {\n        // Send strukturerte feilmeldinger og eventuelle vellykkede filer\n        setFailure(\n          failed,\n          Object.values(errorsByType),\n          succeeded.length > 0 ? succeeded : undefined\n        );\n      } else {\n        // Alt gikk bra\n        setSuccess(succeeded);\n      }\n    } catch (error: unknown) {\n      // Generell feil i selve prosessen\n      setFailure(\n        files.map(file => ({ name: file.name })),\n        [{\n          error: `Det oppstod en feil under opplasting: ${error}`,\n          files: files.map(file => ({ name: file.name }))\n        }]\n      );\n    }\n  };\n\n  return (\n    <FileUploader\n      label=\"Last opp dokumentasjon\"\n      acceptedFileFormats={['.pdf', '.jpeg', '.png']}\n      multiple\n      {...fileUploaderState}\n      onFileDelete={handleDelete}\n      onFileChange={handleChange}\n    />\n  );\n};\n```\n\n## Bruk med FileUploader-komponenten\n\nHooken er designet for å brukes sammen med `FileUploader`-komponenten. Tilstanden fra hooken kan spres (spread) direkte til `FileUploader`.\n\n```jsx\n<FileUploader\n  label={'Last opp et dokument'}\n  acceptedFileFormats={['.pdf', '.jpeg', '.png']}\n  {...fileUploaderState}\n  onFileDelete={handleDelete}\n  onFileChange={handleChange}\n/>\n```\n\n## Spesialisert bruk med egne datatyper\n\nHooken støtter generiske typer for å håndtere egendefinerte datastrukturer i statusmeldinger:\n\n```jsx\n// Definerer en egen datatype for statusmeldinger\ntype CustomErrorData = {\n  code: string;\n  message: string;\n};\n\n// Bruker egendefinert datatype med hooken\nconst [state, setSuccess, setLoading, setFailure, remove] =\n  FileUploader.useFileUploader<CustomErrorData>(\n    // Egendefinert renderer for statusmeldinger\n    (status) => {\n      if (status.data && status.hasUploadFailed) {\n        return <div>Feilkode: {status.data.code} - {status.data.message}</div>;\n      }\n      return status.uploadedFilesMessage;\n    }\n  );\n\n// Senere kan du bruke den egendefinerte datatypen\nsetFailure(\n  [{ name: 'dokument.pdf' }],\n  { code: 'ERR-001', message: 'Ugyldig filformat' }\n);\n```\n\n### Standard feilvisning\n\nHvis du ikke angir en egendefinert `renderStatus`-funksjon, vil hooken vise feilmeldinger på følgende måte:\n\n1. Hvis dataene følger standardformatet (array med `error` og `files`-felter), vises en liste med feilmeldinger og berørte filer.\n2. Ellers vises den generelle statusmeldingen.\n\nDette skjer gjennom den interne `renderFileStatusMessage`-funksjonen, som kontrollerer om feilmeldingsformatet er gyldig ved hjelp av `isUploadError`-funksjonen.\n\n## Tilstandshåndtering\n\nHooken håndterer følgende tilstander:\n\n1. **Initiell tilstand**: Ingen opplastede filer eller med initialt opplastede filer\n2. **Opplasting pågår**: `isUploading` er satt til `true`\n3. **Vellykket opplasting**: Filene legges til i `uploadedFiles` og en suksessmelding vises\n4. **Feilet opplasting**: Feilmelding vises og eventuelle vellykkede filer legges til\n5. **Sletting av filer**: Individuell fil fjernes fra listen\n\n### Struktur for feilmelding\n\nFor at feilmeldinger skal vises riktig, må data som sendes til `setFailure` følge en bestemt struktur:\n\n```typescript\nsetFailure(\n  files, // Filer som feilet\n  [\n    {\n      error: 'Feilmelding', // Tekst som beskriver feilen\n      files: [\n        // Liste over filer som er berørt av denne feilen\n        { name: 'filnavn.pdf', id: 'fil-id' },\n      ],\n    },\n  ],\n  succeededFiles // Valgfri: filer som likevel ble lastet opp\n);\n```\n\nDenne strukturen sikrer at feilmeldinger vises korrekt med filene de gjelder for.\n"],"names":["ReturnValuesTable","ParametersTable","_createMdxContent","props","_components","_provideComponents","_jsxs","_Fragment","_jsx","Meta","Markdown","MDXContent","MDXLayout"],"mappings":"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"}