{"version":3,"file":"Combobox.interaction.test.stories-BKF2L_gl.js","sources":["../../../../apps/ds-playground/src/stories/__tests__/combobox/Combobox.interaction.test.stories.tsx"],"sourcesContent":["import { Meta, StoryObj } from '@storybook/react-vite';\nimport { expect, userEvent, within } from 'storybook/test';\n\nimport { Combobox } from '@skatteetaten/ds-forms';\n\nimport { defaultArgs } from './utils/combobox.test.utils';\n\nconst meta = {\n  component: Combobox,\n  title: 'Tester/Combobox/Interaction',\n  tags: ['test'],\n  parameters: {\n    imageSnapshot: { disableSnapshot: false },\n  },\n} satisfies Meta<typeof Combobox>;\n\nexport default meta;\ntype Story = StoryObj<typeof meta>;\n\nexport const SelectOptionInteraction = {\n  name: 'Åpne dropdown og velg alternativ (A4)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Verifiser at combobox er tilstede og funksjonell\n    await expect(inputElement).toBeInTheDocument();\n    await expect(inputElement).toBeEnabled();\n\n    // Klikk på input for å åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown åpnes og alternativer vises\n    const options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n    await expect(options[0]).toHaveTextContent('Norge');\n    await expect(options[1]).toHaveTextContent('Sverige');\n    await expect(options[2]).toHaveTextContent('Danmark');\n\n    // Velg det første alternativet\n    await userEvent.click(options[0]);\n\n    // Verifiser at valget er gjort og input viser riktig verdi\n    await expect(inputElement).toHaveValue('Norge');\n  },\n} satisfies Story;\n\nexport const KeyboardNavigation = {\n  name: 'Tastaturnavigasjon med piltaster (B1)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input\n    await userEvent.click(inputElement);\n\n    // Åpne dropdown med Alt+Down\n    await userEvent.keyboard('{Alt>}{ArrowDown}{/Alt}');\n\n    // Verifiser at dropdown er åpen\n    const options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Naviger ned med piltast og verifiser fokus\n    await userEvent.keyboard('{ArrowDown}');\n\n    // Verifiser at input har aktivt descendant satt til første option\n    await expect(inputElement).toHaveAttribute('aria-activedescendant');\n\n    await userEvent.keyboard('{ArrowDown}');\n    // Verifiser at vi kan navigere til neste option\n\n    // Naviger opp igjen til første option\n    await userEvent.keyboard('{ArrowUp}');\n\n    // Velg med Enter\n    await userEvent.keyboard('{Enter}');\n\n    // Verifiser at valget er gjort\n    await expect(inputElement).toHaveValue('Norge');\n  },\n} satisfies Story;\n\nexport const SearchFiltering = {\n  name: 'Søk og filtrering av alternativer (A5)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at alle alternativer vises i starten\n    let options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Skriv \"No\" for å filtrere\n    await userEvent.type(inputElement, 'No');\n\n    // Verifiser at kun \"Norge\" vises\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(1);\n    await expect(options[0]).toHaveTextContent('Norge');\n\n    // Slett tekst og skriv \"Da\"\n    await userEvent.clear(inputElement);\n    await userEvent.type(inputElement, 'Da');\n\n    // Verifiser at kun \"Danmark\" vises\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(1);\n    await expect(options[0]).toHaveTextContent('Danmark');\n\n    // Slett tekst og skriv noe som ikke matcher\n    await userEvent.clear(inputElement);\n    await userEvent.type(inputElement, 'xyz');\n\n    // Verifiser at ingen alternativer vises eller en \"ingen treff\" melding\n    const noOptionsMessages = canvas.queryAllByText(/ingen treff/i);\n    if (noOptionsMessages.length > 0) {\n      await expect(noOptionsMessages[0]).toBeInTheDocument();\n    } else {\n      // Alternativt kan det være at options forsvinner helt\n      options = canvas.queryAllByRole('option');\n      await expect(options).toHaveLength(0);\n    }\n  },\n} satisfies Story;\n\nexport const EscapeKeyBehavior = {\n  name: 'Escape key lukker dropdown (A5)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown er åpen\n    let options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Trykk Escape for å lukke dropdown\n    await userEvent.keyboard('{Escape}');\n\n    // Verifiser at dropdown er lukket\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n\n    // Verifiser at input fortsatt har fokus\n    await expect(inputElement).toHaveFocus();\n\n    // Test at Escape også virker når vi har skrevet noe i input\n    await userEvent.type(inputElement, 'Nor');\n\n    // Åpne dropdown igjen\n    await userEvent.keyboard('{Alt>}{ArrowDown}{/Alt}');\n\n    // Verifiser at dropdown åpnes og viser filtrerte resultater\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(1);\n    await expect(options[0]).toHaveTextContent('Norge');\n\n    // Trykk Escape for å lukke dropdown\n    await userEvent.keyboard('{Escape}');\n\n    // Verifiser at dropdown er lukket og tekst forblir i input\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n    await expect(inputElement).toHaveValue('Nor');\n  },\n} satisfies Story;\n\nexport const ClickOutsideToClose = {\n  name: 'Klikk utenfor lukker dropdown (A5)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown er åpen\n    let options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Klikk utenfor combobox (på canvas element)\n    await userEvent.click(canvasElement);\n\n    // Verifiser at dropdown er lukket (vente litt for at click outside skal registreres)\n    await new Promise((resolve) => setTimeout(resolve, 100));\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n\n    // Verifiser at input ikke lenger har fokus\n    await expect(inputElement).not.toHaveFocus();\n\n    // Test at click outside også virker når vi har multiple selection aktiv\n    // Først aktiver multiple mode\n    // Fokuser på input igjen og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown åpnes igjen\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Klikk utenfor igjen\n    await userEvent.click(canvasElement);\n\n    // Verifiser at dropdown lukkes (vent litt for at click outside skal registreres)\n    await new Promise((resolve) => setTimeout(resolve, 100));\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n  },\n} satisfies Story;\n"],"names":["expect","within","meta","component","Combobox","title","tags","parameters","imageSnapshot","disableSnapshot","SelectOptionInteraction","name","args","defaultArgs","play","canvasElement","canvas","inputElement","getByRole","toBeInTheDocument","toBeEnabled","userEvent","click","options","getAllByRole","toHaveLength","toHaveTextContent","toHaveValue","KeyboardNavigation","keyboard","toHaveAttribute","SearchFiltering","type","clear","noOptionsMessages","queryAllByText","length","queryAllByRole","EscapeKeyBehavior","toHaveFocus","ClickOutsideToClose","Promise","resolve","setTimeout","not","docs","source","originalSource"],"mappings":"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"}