{"version":3,"file":"webcomponent-decorator-lYdcJsLo.js","sources":["../../../../apps/ds-playground/.storybook/webcomponent-decorator.tsx"],"sourcesContent":["import { Decorator } from '@storybook/react';\nimport { createRoot, Root } from 'react-dom/client';\n\nexport interface WebcompAttributes {\n  [key: string]: string | undefined;\n}\nexport const webComponent: Decorator = function (Story, context) {\n  const Name = context.parameters['customElementName'] ?? 'ds-customelement';\n  class WebComponent extends HTMLElement {\n    mountPoint!: HTMLElement;\n    props!: WebcompAttributes; // Frivillige attributes som custom-elementet kan ta imot - de oversettes til props\n    root!: Root;\n\n    connectedCallback(): void {\n      this.mountReactComponent();\n    }\n\n    disconnectedCallback(): void {\n      // setTimeout for å gjøre unmount async. Ellers får vi en feilmelding\n      // Warning: Attempted to synchronously unmount a root while React was already rendering.\n      // React cannot finish unmounting the root until the current render has completed,\n      // which may lead to a race condition.\n      setTimeout(() => {\n        this.root.unmount();\n      });\n    }\n\n    // henter custom-elementets attributer - de assigneres til props lengre ned\n    get value(): WebcompAttributes {\n      return Array.from(this.attributes).reduce(\n        (previousValue: { [key: string]: string }, currentValue) => {\n          previousValue[currentValue.name] = currentValue.value;\n          return previousValue;\n        },\n        {}\n      ) as WebcompAttributes;\n    }\n\n    // håndtering av events - disse skal sendes videre til komponentene gjennom bruk av EventForwarder wrappper\n    eventDispatcher = (event: Event): void => {\n      this.dispatchEvent(event);\n    };\n\n    subscribeDispatcher = (\n      eventname: string,\n      callback: (event: Event) => void\n    ): void => {\n      this.addEventListener(eventname, (e) => {\n        return callback(e);\n      });\n    };\n\n    mountReactComponent(): void | null {\n      this.props = this.value;\n      this.mountPoint = document.createElement('div');\n\n      const shadowRoot = this.attachShadow({ mode: 'open' });\n\n      shadowRoot.appendChild(this.mountPoint);\n\n      if (import.meta.env.MODE === 'development') {\n        for (const tag of document.head.querySelectorAll('style')) {\n          const clone = tag.cloneNode(true);\n          shadowRoot.appendChild(clone);\n        }\n      } else {\n        for (const tag of document.head.querySelectorAll('link')) {\n          if (tag.rel === 'stylesheet') {\n            const clone = tag.cloneNode(true);\n            shadowRoot.appendChild(clone);\n          }\n        }\n      }\n\n      this.root = createRoot(this.mountPoint);\n      this.root.render(<Story {...this.props} />);\n    }\n  }\n\n  if (!window.customElements.get(Name)) {\n    window.customElements.define(Name, WebComponent);\n  }\n\n  return <Name />;\n};\n"],"names":["cov_1umbgtk1v8","actualCoverage","Story","context","WebComponent","HTMLElement","constructor","s","arguments","eventDispatcher","event","dispatchEvent","subscribeDispatcher","eventname","callback","addEventListener","e","connectedCallback","mountReactComponent","disconnectedCallback","setTimeout","unmount","from","previousValue","currentValue","value","document","mode","shadowRoot","appendChild","tag","clone","createRoot","render","props","customElements","Name","window","jsx"],"mappings":"8vMAkDI,OAAAA,EAAAC,UAAA,CAAA,OAAAA,CAAA,EAAAA,CAAAD,CAyBmBA,IArEhBA,WAA0DA,MAAAA,EAAA,SAAAE,EAAAC,EAAA,CAC/DH,EAAMA,EAAAA,EAAAA,CAAAA,IACN,MAAMI,GAAAA,IAAqBC,EAAAA,CAAAA,IAAYL,EAAA,EAAA,EAAA,CAAA,EAAA,CAAA,IAAAG,EAAA,WAAA,oBAAAH,EAAA,EAAA,EAAA,CAAA,EAAA,CAAA,IAAA,qBAAvCM,MAAAA,UAAA,WAAA,CAAAN,aAAAA,CAAAA,EAAA,EAAAO,EAAA,CAAA,IAAAP,EAAAQ,EAAAA,EAAA,CAAA,IAAAR,MAAAA,GAAAA,SAAA,EA+BEA,EAAAS,EAAAA,EAAAA,CAAA,IAA0CT,KAAAA,gBAAAU,GAAA,CAAAV,EAAA,EAAAO,EAAA,CAAA,IACxCP,EAAKW,EAAAA,EAAcD,CAAAA,IACrB,KAAA,cAAAA,CAAA,CAAAV,EAEAA,EAAAY,EAAAA,EAAAA,CAAAA,IAGWZ,KAAAA,oBAAA,CAAAa,EAAAC,IAAA,CAAAd,EAAA,EAAAO,EAAA,CAAA,IACTP,EAAKe,EAAAA,EAAAA,CAAAA,IAAmCf,KAAAA,iBAAAa,EAAAG,IAAAhB,EAAA,EAAAO,EAAA,CAAA,IACtCP,EAAOc,EAAU,EAAA,CAAA,IAClBA,EAAAE,CAAA,EACH,CAAA,CArCAC,CAA0BjB,mBAAA,CAAAA,EAAA,EAAAO,EAAA,CAAA,IACxBP,EAAKkB,EAAAA,EAAAA,CAAAA,IACP,KAAA,oBAAA,CAEAC,CAA6BnB,sBAAA,CAAAA,EAAA,EAAAO,EAAA,CAAA,IAK3Ba,EAAW,EAAM,EAAA,CAAA,IAAApB,WAAAA,KAAAA,EAAA,EAAAO,EAAA,CAAA,IACfP,EAAUqB,EAAA,EAAQ,EAAA,IACnB,KAAA,KAAA,QAAA,CACH,CAAA,EAG+BrB,IAAAA,OAAAA,CAAAA,OAAAA,EAAA,EAAAO,EAAA,CAAA,IAC7BP,EAAasB,EAAA,QACiDtB,MAAAA,UAAA,UAAA,EAAA,OAAA,CAAAuB,EAAAC,KAAAxB,EAAA,EAAAO,EAAA,CAAA,IAC1DgB,EAAcC,EAAAA,EAAAA,EAAAA,IAAkCxB,EAAAwB,EAAA,IAAA,EAAAA,EAAA,MAChDxB,EAAOuB,EAAAA,EAAAA,EAAA,IAGXA,GACF,CAAA,CAAA,CAgBAL,CAAmClB,qBAAA,CAAAA,EAAA,EAAAO,EAAA,EAAA,IACjCP,EAAa,EAAA,EAAKyB,EAAAA,IAAAzB,KAAAA,MAAAA,KAAA,MAClBA,IAAK,EAAa0B,EAAAA,IAElB,KAAA,oBAAM1B,cAAA,KAAa,EAAoB2B,MAAAC,GAAM5B,IAAA,EAAA,EAAA,IAAA,KAAA,aAAA,CAAQ,KAAA,MAAAA,CAAAA,GAErD4B,EAAWC,EAAAA,EAAAA,EAAAA,IAA2B7B,EAAAA,YAAA,KAAA,UAAA,EAEtCA,EAA4C,EAAA,EAAA,EAAA,IAKrCA,CAAAA,EAAA,EAAAO,EAAA,CAAA,EAAA,CAAA,IACLP,EAAW,EAAA,EAAO0B,EAAAA,IAAwC1B,UAAAA,cAAA,KAAA,iBAAA,MAAA,EAC1BA,GAA9BA,EAAQ,UAAsBA,EAAAA,MAAA,aAAA,CAC5BA,EAAM,EAAAA,EAAAA,CAAAA,EAAAA,CAAAA,IAA0BA,MAAAA,KAAA,EAAA,EAAA,EAAA,IAAA8B,EAAA,UAAA,EAAA,GAChCF,EAAWC,EAAAA,EAAAA,EAAAA,IACbD,EAAA,YAAAG,CAAA,CAAA/B,MAAAA,EAAA,EAAA,EAAA,CAAA,EAAA,CAAA,GAEJA,CAEAA,EAAYgC,EAAAA,EAAAA,EAAAA,IAA0BhC,KAAAA,KAAAA,aAAA,KAAA,UAAA,EACtCA,EAAUiC,UAAe,KAAG,KAAKC,OAAAA,EAAAA,IAAAA,EAAAA,CAAS,GAAA,KAAA,KAC5C,CAAA,CAAA,CACF,CAAAlC,CAEA,OAAAA,EAAYmC,EAAAA,EAAAA,EAAAA,IAA0BnC,OAAAA,eAAA,IAAAoC,CAAA,EAEtCpC,EAAA,EAAA,EAAA,CAAA,EAAA,CAAA,KAFsCA,EAAA,EAAAO,EAAA,CAAA,EAAA,CAAA,IACpC8B,QAAO,IACT,OAAA,eAAA,OAAAD,EAAAhC,CAAA,GAEAJ,EAAA,EAAA,EAAA,EAAA,IACFsC,EAAAA,IAAAF,EAAA,EAAA"}