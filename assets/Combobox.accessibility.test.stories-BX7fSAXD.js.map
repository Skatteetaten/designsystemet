{"version":3,"file":"Combobox.accessibility.test.stories-BX7fSAXD.js","sources":["../../../../apps/ds-playground/src/stories/__tests__/combobox/Combobox.accessibility.test.stories.tsx"],"sourcesContent":["import { Meta, StoryObj } from '@storybook/react-vite';\nimport { expect, userEvent, within } from 'storybook/test';\n\nimport { Combobox } from '@skatteetaten/ds-forms';\n\nimport { defaultArgs } from './utils/combobox.test.utils';\n\nconst meta = {\n  component: Combobox,\n  title: 'Tester/Combobox/Accessibility',\n  argTypes: {\n    // Baseprops\n    ref: { table: { disable: true } },\n    className: { table: { disable: true } },\n    id: { table: { disable: true } },\n    lang: { table: { disable: true } },\n    'data-testid': { table: { disable: true } },\n    // Props\n    classNames: { table: { disable: true } },\n    label: { table: { disable: true } },\n    options: { table: { disable: true } },\n    placeholder: { table: { disable: true } },\n    variant: { table: { disable: true } },\n    multiple: { table: { disable: true } },\n    value: { table: { disable: true } },\n    description: { table: { disable: true } },\n    errorMessage: { table: { disable: true } },\n    helpText: { table: { disable: true } },\n    hasSpacing: { table: { disable: true } },\n    hideLabel: { table: { disable: true } },\n    minSearchLength: { table: { disable: true } },\n    isLoading: { table: { disable: true } },\n    spinnerLabel: { table: { disable: true } },\n    // HTML attributes\n    name: { table: { disable: true } },\n    disabled: { table: { disable: true } },\n    required: { table: { disable: true } },\n    // Events\n    onSelectionChange: { table: { disable: true } },\n    onInputChange: { table: { disable: true } },\n    onHelpToggle: { table: { disable: true } },\n  },\n  tags: ['test'],\n  parameters: {\n    imageSnapshot: { disableSnapshot: false },\n  },\n} satisfies Meta<typeof Combobox>;\n\nexport default meta;\ntype Story = StoryObj<typeof meta>;\n\nexport const AriaAttributesTest = {\n  name: 'ARIA-attributter for combobox',\n  args: {\n    ...defaultArgs,\n    helpText: 'Dette er hjelpetekst',\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Verifiser grunnleggende ARIA-attributter\n    await expect(inputElement).toBeInTheDocument();\n    await expect(inputElement).toHaveAttribute('aria-autocomplete', 'list');\n    await expect(inputElement).toHaveAttribute('aria-expanded', 'false');\n\n    // Åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at ARIA-attributter oppdateres når dropdown åpnes\n    await expect(inputElement).toHaveAttribute('aria-expanded', 'true');\n    await expect(inputElement).toHaveAttribute('aria-controls');\n\n    // Verifiser at options får korrekte IDs\n    const options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Naviger til første option med piltast\n    await userEvent.keyboard('{ArrowDown}');\n\n    // Verifiser aria-activedescendant\n    const activeDescendant = inputElement.getAttribute('aria-activedescendant');\n    await expect(activeDescendant).toBeTruthy();\n    await expect(options[0]).toHaveAttribute('id', activeDescendant);\n\n    // Verifiser aria-describedby hvis hjelpetekst finnes\n    const describedBy = inputElement.getAttribute('aria-describedby');\n    if (describedBy) {\n      const helpElement = canvas.getByText('Dette er hjelpetekst');\n      await expect(helpElement).toBeInTheDocument();\n    }\n  },\n} satisfies Story;\n\nexport const KeyboardNavigation = {\n  name: 'Tastaturnavigasjon med piltaster (B1)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input\n    await userEvent.click(inputElement);\n\n    // Åpne dropdown med Alt+Down\n    await userEvent.keyboard('{Alt>}{ArrowDown}{/Alt}');\n\n    // Verifiser at dropdown er åpen\n    const options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Naviger ned med piltast og verifiser fokus\n    await userEvent.keyboard('{ArrowDown}');\n\n    // Verifiser at input har aktivt descendant satt til første option\n    await expect(inputElement).toHaveAttribute('aria-activedescendant');\n\n    await userEvent.keyboard('{ArrowDown}');\n    // Verifiser at vi kan navigere til neste option\n\n    // Naviger opp igjen til første option\n    await userEvent.keyboard('{ArrowUp}');\n\n    // Velg med Enter\n    await userEvent.keyboard('{Enter}');\n\n    // Verifiser at valget er gjort\n    await expect(inputElement).toHaveValue('Norge');\n  },\n} satisfies Story;\n\nexport const EscapeKeyBehavior = {\n  name: 'Escape key lukker dropdown (A5)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown er åpen\n    let options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Trykk Escape for å lukke dropdown\n    await userEvent.keyboard('{Escape}');\n\n    // Verifiser at dropdown er lukket\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n\n    // Verifiser at input fortsatt har fokus\n    await expect(inputElement).toHaveFocus();\n\n    // Test at Escape også virker når vi har skrevet noe i input\n    await userEvent.type(inputElement, 'Nor');\n\n    // Åpne dropdown igjen\n    await userEvent.keyboard('{Alt>}{ArrowDown}{/Alt}');\n\n    // Verifiser at dropdown åpnes og viser filtrerte resultater\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(1);\n    await expect(options[0]).toHaveTextContent('Norge');\n\n    // Trykk Escape for å lukke dropdown\n    await userEvent.keyboard('{Escape}');\n\n    // Verifiser at dropdown er lukket og tekst forblir i input\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n    await expect(inputElement).toHaveValue('Nor');\n  },\n} satisfies Story;\n\nexport const ClickOutsideToClose = {\n  name: 'Klikk utenfor lukker dropdown (A5)',\n  args: {\n    ...defaultArgs,\n  },\n  parameters: {\n    imageSnapshot: { disableSnapshot: true },\n  },\n  play: async ({ canvasElement }): Promise<void> => {\n    const canvas = within(canvasElement);\n    const inputElement = canvas.getByRole('combobox');\n\n    // Fokuser på input og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown er åpen\n    let options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Klikk utenfor combobox (på canvas element)\n    await userEvent.click(canvasElement);\n\n    // Verifiser at dropdown er lukket (vente litt for at click outside skal registreres)\n    await new Promise((resolve) => setTimeout(resolve, 100));\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n\n    // Verifiser at input ikke lenger har fokus\n    await expect(inputElement).not.toHaveFocus();\n\n    // Test at click outside også virker når vi har multiple selection aktiv\n    // Først aktiver multiple mode\n    // Fokuser på input igjen og åpne dropdown\n    await userEvent.click(inputElement);\n\n    // Verifiser at dropdown åpnes igjen\n    options = canvas.getAllByRole('option');\n    await expect(options).toHaveLength(3);\n\n    // Klikk utenfor igjen\n    await userEvent.click(canvasElement);\n\n    // Verifiser at dropdown lukkes (vent litt for at click outside skal registreres)\n    await new Promise((resolve) => setTimeout(resolve, 100));\n    options = canvas.queryAllByRole('option');\n    await expect(options).toHaveLength(0);\n  },\n} satisfies Story;\n"],"names":["expect","within","meta","component","Combobox","title","argTypes","ref","table","disable","className","id","lang","classNames","label","options","placeholder","variant","multiple","value","description","errorMessage","helpText","hasSpacing","hideLabel","minSearchLength","isLoading","spinnerLabel","name","disabled","required","onSelectionChange","onInputChange","onHelpToggle","tags","parameters","imageSnapshot","disableSnapshot","AriaAttributesTest","args","defaultArgs","play","canvasElement","canvas","inputElement","getByRole","toBeInTheDocument","toHaveAttribute","userEvent","click","getAllByRole","toHaveLength","keyboard","activeDescendant","getAttribute","toBeTruthy","helpElement","getByText","KeyboardNavigation","toHaveValue","EscapeKeyBehavior","queryAllByRole","toHaveFocus","type","toHaveTextContent","ClickOutsideToClose","Promise","resolve","setTimeout","not","docs","source","originalSource"],"mappings":"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"}